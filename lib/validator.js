"use strict";function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}var Validator=function(){function a(){_classCallCheck(this,a);var b=require("./turbo");this.turbo=new b,this.rulesErrors={required:"Field {fieldName} is required",string:"Field {fieldName} must be a string",integer:"Field {fieldName} must be a number",max:"Maximal length of field {fieldName} is {additionalValue}",min:"Minimal length of field {fieldName} is {additionalValue}",maxNum:"Maximum number is {additionalValue}",minNum:"Minimum number is {additionalValue}",email:"This e-mail is not valid",accepted:"Your consent with {fieldName} is required",selected:"At least one option must be selected"},this.rulesMethods={required:this.notEmpty,string:this.isString,integer:this.isNumber,max:this.maxLength,min:this.minLength,maxNum:this.maxNumber,minNum:this.minNumber,email:this.email,accepted:this.accepted,selected:this.selected}}return _createClass(a,[{key:"notEmpty",value:function notEmpty(a){return""!==a}},{key:"isString",value:function isString(a){return"string"==typeof a}},{key:"isNumber",value:function isNumber(a){return"number"==typeof a}},{key:"maxLength",value:function maxLength(a,b){return a.length<=b}},{key:"minLength",value:function minLength(a,b){return a.length>=b}},{key:"maxNumber",value:function maxNumber(a,b){return a<=b}},{key:"minNumber",value:function minNumber(a,b){return a>=b}},{key:"email",value:function email(a){return /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\\])/.test(a)}},{key:"accepted",value:function accepted(a){return!!a}},{key:"selected",value:function selected(a){return!this.turbo.isEmpty(a)}},{key:"validate",value:function validate(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],e=this.turbo.collectFormData(a),f=this.addValidationRules(e,b),g=this.validator(f,c);return this.hideFormErrors(a),!!g.valid||(d&&this.showFormErrors(a,g.errors),!1)}},{key:"addValidationRules",value:function addValidationRules(a,b){var c={};for(var d in a){var e=d.replace("[]","");c[e]={value:a[d],rules:b[e]}}return c}},{key:"validator",value:function validator(a,b){var c={},d=!0;if(!this.turbo.isEmpty(a))for(var e in a)if("undefined"!=typeof a[e].rules){var f=this.validateData(e,a[e]);if(!f.valid&&(d=!1,c[e]=f.error,b))break}return{valid:d,errors:c}}},{key:"validateData",value:function validateData(a,b){var c=b.value,d=b.rules,e={rules:d,fieldName:""};if(this.turbo.isObject(d)&&d.hasOwnProperty("fieldName")&&d.hasOwnProperty("fieldName")&&(e.rules=b.rules.rules?b.rules.rules:[],e.fieldName=b.rules.fieldName),e.rules=e.rules.split("|"),0<e.rules.length){var f,g=_createForOfIteratorHelper(e.rules);try{for(g.s();!(f=g.n()).done;){var h=f.value,i=void 0,j=void 0,k=void 0;i=!0,j=h,k="";var l=h.indexOf(":");-1<l?(j=h.substr(0,l),k=h.substr(l),i=this.rulesMethods[j].bind(this,c,k)()):i=this.rulesMethods[j].bind(this,c)();var m=this.rulesErrors[j];return!i&&-1<m.indexOf("{additionalValue}")&&(m=m.replace("{additionalValue}",k)),!i&&-1<m.indexOf("{fieldName}")&&e.fieldName&&(m=m.replace("{fieldName}","\"".concat(e.fieldName,"\""))),{valid:i,error:m}}}catch(a){g.e(a)}finally{g.f()}}}},{key:"showFormErrors",value:function showFormErrors(a,b){var c=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];for(var g in a=this.turbo.beNode(a),b){var d=a.querySelector("[name=\"".concat(g,"\"]")),e=a.querySelector("[name=\"".concat(g,"[]\"]")),f=this.getErrorWithFieldName(d,b[g]);!d&&e&&(d=e);var h=this.turbo.createElement("p",f,{class:["input-error"]});d&&(c?this.turbo.showElement(h,d.closest(".turbo-ui")):this.turbo.showElement(h,d,"insertAfter"))}}},{key:"getErrorWithFieldName",value:function getErrorWithFieldName(a,b){if(-1<b.indexOf("{fieldName}")){var c=a.parentElement.querySelector("label").textContent;b=b.replace("{fieldName}","\"".concat(c,"\""))}return b}},{key:"hideFormErrors",value:function hideFormErrors(a){a=this.turbo.beNode(a);var b=a.querySelectorAll(".input-error");if(b)for(var c=0;c<b.length;c++)b[c].remove()}}]),a}();module.exports=Validator;