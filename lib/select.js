"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}var Select=function(){function a(){_classCallCheck(this,a);var b=require("./turbo");this.turbo=new b,this.selects={},this.custom={},this.animationSettings={open:"animation-slide-in-top",close:"animation-slide-out-top",duration:150}}return _createClass(a,[{key:"initSelects",value:function initSelects(){var a=document.querySelectorAll(".turbo-ui.select");if(a)for(var d=0;d<a.length;d++){var b=a[d],c=b.querySelector("select");if(c){var e="turbo-select-".concat(d+1);this.generateTurboSelect(b,e),this.bindSelectActions(b)}}}},{key:"generateTurboSelect",value:function generateTurboSelect(a,b){var c,d=a.querySelector("select"),e=a.querySelector("label"),f=d.classList.contains("searchable"),g=d.classList.contains("multiselect"),h=a.getAttribute("id"),i=null===(c=this.custom[h])||void 0===c?void 0:c.settings,j=Array.from(d.options),k=this.generateMainElements(b,{searchable:f,multiselect:g},e.textContent),l=this.getOptionsInfo(j,i),m=this.generateOptions(l);this.showOptionsInWrapper(k.optionsWrapper,m),this.turbo.showElement(k.label,k.selectionWrapper,"prepend","block",{}),this.turbo.showElement(k.optionsWrapper,k.selectionWrapper,"append","none",{}),this.turbo.showElement(k.selectionWrapper,k.turboSelectElement,"append","flex",{}),this.turbo.showElement(k.arrow,k.turboSelectElement,"append","flex",{}),this.turbo.showElement(k.turboSelectElement,a,"append","flex",{}),this.createInstance(l,b,k.label?e.textContent:null,f,g)}},{key:"generateMainElements",value:function generateMainElements(a,b,c){for(var d=this.turbo.createElement("div",null,{class:["turbo-select"],id:a}),e=this.turbo.createElement("div",null,{class:["options-wrapper"]}),f=this.generateLabel(c,b.searchable),g=this.turbo.createElement("div",null,{class:["options"]}),h=this.turbo.createElement("div",null,{class:["dropdown-arrow"]}),j=0;2>j;j++)this.turbo.showElement(this.turbo.createElement("div",null,{class:["arrow-part"]}),h,"append","block",{});return{turboSelectElement:d,selectionWrapper:e,label:f,optionsWrapper:g,arrow:h}}},{key:"generateLabel",value:function generateLabel(a,b){var c=["label"];b&&c.push("search");var d=this.turbo.createElement("div",b?null:a,{class:c});if(b){var e=this.turbo.createElement("input",null,{placeholder:a,id:"options-search",autocomplete:"off"});this.turbo.showElement(e,d,"append","block",{})}return d}},{key:"generateNotFoundOptionInfo",value:function generateNotFoundOptionInfo(a){var b=this.selects[a].settings.notFoundOptionValue;return{text:this.turbo.settings.text.notFound,value:b,attributes:{dataset:{value:b},class:["disabled","not-found-option"]},disabled:!0,notFoundOption:!0}}},{key:"getOptionsInfo",value:function getOptionsInfo(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=!1;if(e.hasAttribute("disabled")&&(f=!0),e){var g=e.textContent,h=e.value,j={dataset:{value:h},class:[]};if(f){if(this.turbo.settings.select.hideDisabledOptions&&!b||null!==b&&void 0!==b&&b.hideDisabledOptions)continue;j["class"]=["disabled"]}c.push({text:g,value:h,attributes:{class:j["class"],dataset:j.dataset},disabled:f})}}return c}},{key:"generateOptions",value:function generateOptions(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],c.push(this.turbo.createElement("div",b.text,b.attributes));return c}},{key:"showOptionsInWrapper",value:function showOptionsInWrapper(a,b){for(var c=0;c<b.length;c++)this.turbo.showElement(b[c],a,"append","block",{})}},{key:"createInstance",value:function createInstance(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=document.querySelector("#".concat(b)),u=t.closest(".turbo-ui.select"),v=u.getAttribute("id");this.selects[b]={id:b,wrapperId:v&&null!==(f=this.custom[v])&&void 0!==f&&f.customId?null===(g=this.custom[v])||void 0===g?void 0:g.customId:null,wrapper:t,defaultOptions:a,options:a,settings:{searchAlsoValue:v&&null!==(h=this.custom[v])&&void 0!==h&&null!==(i=h.settings)&&void 0!==i&&i.searchAlsoValue?null===(j=this.custom[v])||void 0===j||null===(k=j.settings)||void 0===k?void 0:k.searchAlsoValue:this.turbo.settings.select.searchAlsoValue,notFoundOptionValue:v&&null!==(l=this.custom[v])&&void 0!==l&&null!==(m=l.settings)&&void 0!==m&&m.notFoundOptionValue?null===(n=this.custom[v])||void 0===n||null===(o=n.settings)||void 0===o?void 0:o.notFoundOptionValue:this.turbo.settings.select.notFoundOptionValue,hideDisabledOptions:v&&null!==(p=this.custom[v])&&void 0!==p&&null!==(q=p.settings)&&void 0!==q&&q.hideDisabledOptions?null===(r=this.custom[v])||void 0===r||null===(s=r.settings)||void 0===s?void 0:s.hideDisabledOptions:this.turbo.settings.select.hideDisabledOptions},defaultLabel:c,selectedOption:null,searchable:d,multiselect:e}}},{key:"isSearchable",value:function isSearchable(a){return this.selects[a].searchable}},{key:"isMultiselect",value:function isMultiselect(a){return this.selects[a].multiselect}},{key:"bindSelectActions",value:function bindSelectActions(a){var b=this,c=a.querySelector(".turbo-select");if(c){var d=a.querySelector(".turbo-select .options-wrapper"),e=d.querySelectorAll(".options div"),f=a.querySelector(".turbo-select .dropdown-arrow"),g=c.id;if(d.addEventListener("click",function(c){c.stopPropagation(),b.toggleOptions(a,g)}),f.addEventListener("click",function(c){c.stopPropagation(),b.toggleOptions(a,g)}),this.bindSelection(e,g),this.isSearchable(g)){var h=d.querySelector("#options-search");this.bindFiltering(h,g)}}}},{key:"bindSelection",value:function bindSelection(a,b){for(var c=this,d=function _loop(d){var f=a[d];f.addEventListener("click",function(a){a.stopPropagation(),c.selectOption(f,b)})},e=0;e<a.length;e++)d(e)}},{key:"toggleOptions",value:function toggleOptions(a,b){var c=a.querySelector(".options"),d=!c.classList.contains("opened");d?this.openOptions(c,b):(this.reselectOption(b),this.closeOptions(c))}},{key:"openOptions",value:function openOptions(a,b){var c=this.isSearchable(b);if(c){var d=a.closest(".options-wrapper").querySelector(".label"),e=d.querySelector("#options-search"),f=e.value;this.turbo.isEmpty(f)||(e.value="",e.setAttribute("placeholder",f))}this.turbo.toggleAnimationClass(a,"animation-slide-in-top",this.animationSettings.duration),a.style.display="block",a.classList.add("opened"),this.bindCloseOptionsFromOutside(a,b)}},{key:"closeOptions",value:function closeOptions(a){a.classList.remove("opened"),this.turbo.toggleAnimationClass(a,"animation-slide-out-top",this.animationSettings.duration),setTimeout(function(){a.style.display="none"},this.animationSettings.duration)}},{key:"bindCloseOptionsFromOutside",value:function bindCloseOptionsFromOutside(a,b){var c=this;document.addEventListener("click",function d(){if(a.classList.contains("opened"))if(c.shouldSelectFirstOption(b)){var e=c.selects[b].options[0].value;c.canSelectOption(e,b)&&c.selectOption({value:e},b)}else c.reselectOption(b),c.closeOptions(a);document.removeEventListener("click",d)})}},{key:"shouldSelectFirstOption",value:function shouldSelectFirstOption(a){if(1===this.selects[a].options.length&&!this.areOptionsNotFound(a)&&null===this.selects[a].selectedOption)return!0}},{key:"areOptionsNotFound",value:function areOptionsNotFound(a){var b,c=this.selects[a].options[0].value;return!!(null!==(b=this.getOptionInfoByValue(a,c))&&void 0!==b&&b.notFoundOption)}},{key:"reselectOption",value:function reselectOption(a){var b=this.selects[a].selectedOption,c=null===b||void 0===b?void 0:b.value;c&&this.updateSelectedElement(a);var d=null===b||void 0===b?void 0:b.element;(d||c)&&this.canSelectOption(null!==d&&void 0!==d?d:c,a)&&this.selectOption(null!==d&&void 0!==d?d:{value:c},a,!1)}},{key:"updateSelectedElement",value:function updateSelectedElement(a){var b,c=null===(b=this.selects[a].selectedOption)||void 0===b?void 0:b.value;c&&(this.selects[a].selectedOption.element=document.querySelector("#".concat(a," div[data-value=\"").concat(c,"\"]")))}},{key:"selectOption",value:function selectOption(a,b){var c=this,d=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],e=this.selects[b].wrapper,f=e.closest(".turbo-ui.select").querySelector("select"),g=e.querySelector(".options"),h=e.querySelector(".label"),i=this.isSearchable(b),j=this.isMultiselect(b);this.canSelectOption(a,b)&&(this.closeOptions(g),setTimeout(function(){c.unsetSelected(b),c.resetSelect(g,h,b),a=c.turbo.isObject(a)&&!c.turbo.isNode(a)&&a.value?g.querySelector("div[data-value=\"".concat(a.value,"\"]")):g.querySelector("div[data-value=\"".concat(c.turbo.getData(a,"value"),"\"]"));var e=c.turbo.getData(a,"value"),j=a.textContent;if(h.classList.add("selected"),a.classList.add("active"),c.selects[b].selectedOption={value:e,text:j,element:a},i){var k=h.querySelector("#options-search");k.value=j,k.setAttribute("placeholder",j)}else h.textContent=j;f.value=e,d&&c.triggerChangeEvent(f)},this.animationSettings.duration))}},{key:"unsetSelected",value:function unsetSelected(a){this.selects[a].selectedOption=null;var b,c=_createForOfIteratorHelper(this.selects[a].defaultOptions);try{for(c.s();!(b=c.n()).done;){var d=b.value,e=_toConsumableArray(d.attributes["class"]),f=e.indexOf("active");-1<f&&e.splice(f,1),d.attributes["class"]=e}}catch(a){c.e(a)}finally{c.f()}}},{key:"canSelectOption",value:function canSelectOption(a,b){var c=a;this.turbo.isNode(a)&&(c=this.turbo.getData(a,"value"));var d=this.getOptionInfoByValue(b,c);return!(null!==d&&void 0!==d&&d.disabled)&&!(null!==d&&void 0!==d&&d.notFoundOption)}},{key:"getOptionInfoByValue",value:function getOptionInfoByValue(a,b){if(b===this.selects[a].settings.notFoundOptionValue)return{notFoundOption:!0};var c=this.selects[a].defaultOptions.filter(function(a){return a.value===b});if(c.length)return c[0]}},{key:"isSelected",value:function isSelected(a,b){var c;return(null===(c=this.selects[a].selectedOption)||void 0===c?void 0:c.value)===b}},{key:"resetSelect",value:function resetSelect(a,b,c){var d=a.querySelectorAll("div"),e=this.isSearchable(c);this.selects[c].selectedOption=null,b=this.generateLabel(this.selects[c].defaultLabel,e);for(var f,g=0;g<d.length;g++)f=d[g],f.classList.contains("active")&&f.classList.remove("active");this.resetOptions(c)}},{key:"resetOptions",value:function resetOptions(a){var b=this.selects[a].wrapper,c=b.querySelector(".options"),d=c.querySelectorAll("div"),e=this.selects[a].defaultOptions;e=this.activateSelectedOptions(a,e);var f,g=this.generateOptions(e),h=_createForOfIteratorHelper(d);try{for(h.s();!(f=h.n()).done;){var i=f.value;i.remove()}}catch(a){h.e(a)}finally{h.f()}this.showOptionsInWrapper(c,g,!1),this.bindSelection(c.querySelectorAll("div"),a),this.selects[a].options=e}},{key:"triggerChangeEvent",value:function triggerChangeEvent(a){var b=new Event("change");a.dispatchEvent(b)}},{key:"bindFiltering",value:function bindFiltering(a,b){var c=this,d=a.closest(".options-wrapper").querySelector(".options");a.addEventListener("input",function(){var e=a.value.toLowerCase(),f=c.filterOptions(e,b);c.replaceOptions(d,f,b)})}},{key:"filterOptions",value:function filterOptions(a,b){var c=this.selects[b].defaultOptions,d=[],e=[];if(""===a)return c;var f,g=_createForOfIteratorHelper(c);try{for(g.s();!(f=g.n()).done;){var h=f.value,i=h.value,j=h.text,k=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),l=j.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");-1<l.indexOf(a)&&(d.push(h),e.push(i)),this.selects[b].settings.searchAlsoValue&&!e.includes(i)&&-1<k.indexOf(a)&&d.push(h)}}catch(a){g.e(a)}finally{g.f()}return d}},{key:"replaceOptions",value:function replaceOptions(a,b,c){b=this.activateSelectedOptions(c,b);var d,e=this.generateOptions(b),f=this.selects[c].wrapper.querySelector(".options"),g=_createForOfIteratorHelper(a.querySelectorAll("div"));try{for(g.s();!(d=g.n()).done;){var i=d.value;i.remove()}}catch(a){g.e(a)}finally{g.f()}this.turbo.isEmpty(b)&&(b=[this.generateNotFoundOptionInfo(c)],e=this.generateOptions(b)),this.selects[c].options=b,this.showOptionsInWrapper(f,e);var h=this.selects[c].wrapper.querySelectorAll(".options div");this.bindSelection(h,c)}},{key:"activateSelectedOptions",value:function activateSelectedOptions(a,b){var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var g=c.value;if(this.isSelected(a,g.value)){var e=_toConsumableArray(g.attributes["class"]),f=e.indexOf("active");-1<f&&e.splice(f,1),e.push("active"),g.attributes["class"]=e}}}catch(a){d.e(a)}finally{d.f()}return b}}]),a}();module.exports=Select;