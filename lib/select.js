"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}var Select=function(){function a(){_classCallCheck(this,a);var b=require("./turbo");this.turbo=new b,this.selects={},this.custom={},this.animationSettings={open:"animation-slide-in-top",close:"animation-slide-out-top",duration:150},this.beautySpace=10}return _createClass(a,[{key:"initSelect",value:function initSelect(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,b=a.querySelectorAll(".turbo-ui.select");if(b)for(var e=0;e<b.length;e++){var c=b[e],d=c.querySelector("select");if(d&&"none"!==this.turbo.getCss(d,"display")){var f="turbo-select-".concat(e+1);this.generateTurboSelect(c,f),this.bindSelectActions(c)}}}},{key:"generateTurboSelect",value:function generateTurboSelect(a,b){var c,d=a.querySelector("select"),e=a.querySelector("label"),f=d.classList.contains("searchable"),g=d.classList.contains("multiselect"),h=a.getAttribute("id"),i=null===(c=this.custom[h])||void 0===c?void 0:c.settings,j=Array.from(d.options),k=e?e.textContent:"",l=this.generateMainElements(b,{searchable:f,multiselect:g},k,g,f),m=this.getOptionsInfo(j,i),n=this.generateOptions(m);this.showOptionsInWrapper(l.optionsWrapper,n),this.turbo.showElement(l.label,l.selectionWrapper,"prepend","block",{}),this.turbo.showElement(l.optionsWrapper,l.selectionWrapper,"append","none",{}),this.turbo.showElement(l.selectionWrapper,l.turboSelectElement,"append","flex",{}),this.turbo.showElement(l.arrow,l.turboSelectElement,"append","flex",{}),d.style.display="none",this.turbo.showElement(l.turboSelectElement,a,"append","flex",{}),this.createInstance(m,b,l.label?k:null,f,g),this.updateLabel(b)}},{key:"generateMainElements",value:function generateMainElements(a,b,c){var d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],e=!!(4<arguments.length&&void 0!==arguments[4])&&arguments[4],f=["turbo-select"];d&&f.push("multiselect"),e&&f.push("searchable");for(var g=this.turbo.createElement("div",null,{class:f,id:a}),h=this.turbo.createElement("div",null,{class:["options-wrapper"]}),j=this.generateLabel(c,b.searchable),k=this.turbo.createElement("div",null,{class:["options"]}),l=this.turbo.createElement("div",null,{class:["dropdown-arrow"]}),m=0;2>m;m++)this.turbo.showElement(this.turbo.createElement("div",null,{class:["arrow-part"]}),l,"append","block",{});return{turboSelectElement:g,selectionWrapper:h,label:j,optionsWrapper:k,arrow:l}}},{key:"generateLabel",value:function generateLabel(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=["label"];b&&d.push("search");var e=this.turbo.createElement("div",b?null:a,{class:d});if(b){var f=this.turbo.createElement("input",null,{placeholder:a?a:"",class:["options-search"],autocomplete:"off"});if(c)return f;this.turbo.showElement(f,e,"append","block",{})}return e}},{key:"generateAdditionalOption",value:function generateAdditionalOption(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"notFound";if(["notFound","allSelected"].includes(b)){var c="notFound"===b?this.selects[a].settings.notFoundOptionValue:this.selects[a].settings.allOptionsSelectedOptionValue,d="notFound"===b?this.turbo.settings.text.notFound:this.turbo.settings.text.allSelected,e=["disabled"];return"notFound"===b?e.push("not-found-option"):e.push("all-selected-option"),{text:d,value:c,attributes:{dataset:{value:c},class:e},disabled:!0,notFoundOption:"notFound"===b,allSelectedOption:"allSelected"===b}}return{}}},{key:"generateSelectedOption",value:function generateSelectedOption(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=["selected-option"];c&&d.push("next-row");for(var e=this.turbo.createElement("div",a,{class:d,dataset:{value:b}}),f=this.turbo.createElement("div",null,{class:["remove-button"]}),g=0;2>g;g++)this.turbo.showElement(this.turbo.createElement("div",null,{class:["remove-line"]}),f,"append","block",{});return this.turbo.showElement(f,e,"append","block",{}),e}},{key:"getOptionsInfo",value:function getOptionsInfo(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=!1;if(e.hasAttribute("disabled")&&(f=!0),e){var g=e.textContent,h=e.value,j={dataset:{value:h},class:[]};if(f){if(this.turbo.settings.select.hideDisabledOptions&&!b||null!==b&&void 0!==b&&b.hideDisabledOptions)continue;j["class"]=["disabled"]}c.push({text:g,value:h,attributes:{class:j["class"],dataset:j.dataset},disabled:f})}}return c}},{key:"generateOptions",value:function generateOptions(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],c.push(this.turbo.createElement("div",b.text,b.attributes));return c}},{key:"showOptionsInWrapper",value:function showOptionsInWrapper(a,b){for(var c=0;c<b.length;c++)this.turbo.showElement(b[c],a,"append","block",{})}},{key:"createInstance",value:function createInstance(a,b,c,d,e){var f,g,h,i=document.querySelector("#".concat(b)),j=i.closest(".turbo-ui.select"),k=j.getAttribute("id"),l=null===(f=this.custom[k])||void 0===f?void 0:f.settings,m=this.turbo.settings.select;if(this.selects[b]={id:b,wrapperId:k&&null!==(g=this.custom[k])&&void 0!==g&&g.customId?null===(h=this.custom[k])||void 0===h?void 0:h.customId:null,wrapper:i,defaultOptions:a,options:a,settings:{searchAlsoValue:k&&"undefined"!=typeof(null===l||void 0===l?void 0:l.searchAlsoValue)?l.searchAlsoValue:m.searchAlsoValue,notFoundOptionValue:k&&"undefined"!=typeof(null===l||void 0===l?void 0:l.notFoundOptionValue)?l.notFoundOptionValue:m.notFoundOptionValue,allOptionsSelectedOptionValue:k&&"undefined"!=typeof(null===l||void 0===l?void 0:l.allOptionsSelectedOptionValue)?l.allOptionsSelectedOptionValue:m.allOptionsSelectedOptionValue,autoSelect:k&&"undefined"!=typeof(null===l||void 0===l?void 0:l.autoSelect)?l.autoSelect:m.autoSelect,customLabel:k&&"undefined"!=typeof(null===l||void 0===l?void 0:l.customLabel)?l.customLabel:m.customLabel},label:c,selectedOption:e?[]:null,searchable:d,multiselect:e},e){var n,o,p,q,r,s,t=k&&"undefined"!=typeof(null===(n=this.custom[k])||void 0===n||null===(o=n.settings)||void 0===o||null===(p=o.multiselect)||void 0===p?void 0:p.hideSelected);this.selects[b].settings.multiselect={},this.selects[b].settings.multiselect.hideSelected=t?this.custom[k].settings.multiselect.hideSelected:this.turbo.settings.select.multiselect.hideSelected,this.selects[b].settings.multiselect.hideOptionsAfterSelect=k&&"undefined"!=typeof(null===(q=this.custom[k])||void 0===q||null===(r=q.settings)||void 0===r||null===(s=r.multiselect)||void 0===s?void 0:s.hideOptionsAfterSelect)?this.custom[k].settings.multiselect.hideOptionsAfterSelect:this.turbo.settings.select.multiselect.hideOptionsAfterSelect,t&&(this.selects[b].settings.hideDisabledOptions=!0)}}},{key:"getSelectId",value:function getSelectId(a){return a=this.turbo.beNode(a),a.closest(".turbo-ui.select").querySelector(".turbo-select").id}},{key:"isSearchable",value:function isSearchable(a){return this.selects[a].searchable}},{key:"isMultiselect",value:function isMultiselect(a){return this.selects[a].multiselect}},{key:"bindSelectActions",value:function bindSelectActions(a){var b=this,c=a.querySelector(".turbo-select");if(c){var d=a.querySelector(".turbo-select .options-wrapper"),e=d.querySelectorAll(".options div"),f=a.querySelector(".turbo-select .dropdown-arrow"),g=c.id;if(this.isSearchable(g)){var h=d.querySelector(".options-search");this.bindFiltering(h,g)}d.addEventListener("click",function(c){c.stopPropagation(),b.toggleOptions(a,g)}),f.addEventListener("click",function(c){c.stopPropagation(),b.toggleOptions(a,g)}),this.bindSelection(e,g)}}},{key:"bindSelection",value:function bindSelection(a,b){for(var c=this,d=function _loop(d){var f=a[d];f.addEventListener("click",function(a){a.stopPropagation(),c.selectOption(f,b)})},e=0;e<a.length;e++)d(e)}},{key:"bindOptionDelete",value:function bindOptionDelete(a,b){var c=this,d=a.querySelector(".remove-button");d.addEventListener("click",function(d){d.stopPropagation(),c.removeOption(a,b)}),a.addEventListener("click",function(a){a.stopPropagation()})}},{key:"toggleOptions",value:function toggleOptions(a,b){var c=a.querySelector(".options"),d=!c.classList.contains("opened");d?(this.openOptions(b),this.isSearchable(b)&&a.querySelector(".options-search").focus()):(this.reselectOption(b),this.closeOptions(b))}},{key:"updateLabel",value:function updateLabel(a){var b,c=this.selects[a],d=c.wrapper.closest(".turbo-ui.select").querySelector("label"),e=c.wrapper.querySelector(".label"),f=_createForOfIteratorHelper(c.options);try{for(f.s();!(b=f.n()).done;){var g=b.value;if(this.canSelectOption(g,a)){d||(c.searchable?e.querySelector("input").placeholder=g.text:e.textContent=g.text),!c.multiselect&&c.settings.autoSelect&&this.selectOption(g,a,!1);break}}}catch(a){f.e(a)}finally{f.f()}if(!c.settings.autoSelect&&""!==c.settings.customLabel){var h=c.settings.customLabel;c.searchable?e.querySelector("input").placeholder=h:e.textContent=h}}},{key:"openOptions",value:function openOptions(a){var b=this.isSearchable(a),c=this.isMultiselect(a),d=this.selects[a].wrapper.querySelector(".options");if(b){var e=d.closest(".options-wrapper").querySelector(".label"),f=e.querySelector(".options-search"),g=f.value;this.turbo.isEmpty(g)||(f.value="",f.setAttribute("placeholder",g))}d.style.display="block",d.classList.add("opened"),c&&this.setOptionWrapperPosition(a),this.bindCloseOptionsFromOutside(d,a)}},{key:"setOptionWrapperPosition",value:function setOptionWrapperPosition(a){var b=this.selects[a].wrapper,c=b.querySelector(".options-wrapper"),d=b.querySelector(".options"),e=parseFloat(this.turbo.getCss(b,"height")),f=parseFloat(this.turbo.getCss(c,"min-height"));d.style.top=e-f+"px"}},{key:"closeOptions",value:function closeOptions(a){var b=this,c=this.selects[a].wrapper.querySelector(".options");c.classList.remove("opened"),this.turbo.toggleAnimationClass(c,"animation-slide-out-top",this.animationSettings.duration),setTimeout(function(){c.style.display="none",b.turbo.toggleAnimationClass(c,"animation-slide-in-top",b.animationSettings.duration)},this.animationSettings.duration)}},{key:"bindCloseOptionsFromOutside",value:function bindCloseOptionsFromOutside(a,b){var c=this;document.addEventListener("click",function d(){if(a.classList.contains("opened")){if(c.shouldSelectFirstOption(b)){var e=c.selects[b].options[0].value;c.canSelectOption(e,b)&&c.selectOption({value:e},b)}else c.reselectOption(b),c.closeOptions(b);c.isMultiselect(b)&&c.isSearchable(b)&&(a.closest(".options-wrapper").querySelector(".options-search").value="",setTimeout(function(){c.resetOptions(b,c.selectableOptions(b))},c.animationSettings.duration))}document.removeEventListener("click",d)})}},{key:"shouldSelectFirstOption",value:function shouldSelectFirstOption(a){if(1===this.selects[a].options.length&&!this.areOptionsNotFound(a)&&null===this.selects[a].selectedOption)return!0}},{key:"areOptionsNotFound",value:function areOptionsNotFound(a){var b,c=this.selects[a].options[0].value;return!!(null!==(b=this.getOptionInfoByValue(a,c))&&void 0!==b&&b.notFoundOption)}},{key:"reselectOption",value:function reselectOption(a){var b=this.selects[a].selectedOption,c=null===b||void 0===b?void 0:b.value;c&&this.updateSelectedElement(a);var d=null===b||void 0===b?void 0:b.element;(d||c)&&this.canSelectOption(null!==d&&void 0!==d?d:c,a)&&this.selectOption(null!==d&&void 0!==d?d:{value:c},a,!1)}},{key:"updateSelectedElement",value:function updateSelectedElement(a){var b,c=null===(b=this.selects[a].selectedOption)||void 0===b?void 0:b.value;c&&(this.selects[a].selectedOption.element=document.querySelector("#".concat(a," div[data-value=\"").concat(c,"\"]")))}},{key:"selectOption",value:function selectOption(a,b){var c=this,d=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],e=this.selects[b].wrapper,f=e.closest(".turbo-ui.select").querySelector("select"),g=e.querySelector(".options"),h=e.querySelector(".label"),i=this.isSearchable(b),j=this.isMultiselect(b);this.canSelectOption(a,b)&&((!j||this.selects[b].settings.multiselect.hideOptionsAfterSelect)&&this.closeOptions(b),setTimeout(function(){j||(c.unsetSelected(b),c.resetSelect(g,h,b)),a=c.turbo.isObject(a)&&!c.turbo.isNode(a)&&a.value?g.querySelector("div[data-value=\"".concat(a.value,"\"]")):g.querySelector("div[data-value=\"".concat(c.turbo.getData(a,"value"),"\"]"));var e=null;try{e=c.turbo.getData(a,"value")}catch(a){return console.error("This option cannot be selected"),!1}var k=a.textContent;h.classList.add("selected"),a.classList.add("active");var l={value:e,text:k,element:a};if(j?c.selects[b].selectedOption.push(l):c.selects[b].selectedOption=l,i&&!j){var m=h.querySelector(".options-search");m.value=k,m.setAttribute("placeholder",k)}else j?(c.showSelectedOptions(b),c.hideSelectedOption(b,a),(0===c.selects[b].options.length||null===c.selects[b].options)&&c.addAllSelectedOption(b)):h.textContent=k;j?c.selectRealOption(b,e):f.value=e,d&&c.triggerChangeEvent(f)},this.animationSettings.duration))}},{key:"selectRealOption",value:function selectRealOption(a,b){var c=this.selects[a].wrapper.closest(".turbo-ui.select"),d=c.querySelector("select");d.querySelector("option[value=\"".concat(b,"\"]")).selected=!0}},{key:"removeOption",value:function removeOption(a,b){var c=this.turbo.getData(a,"value");if(a.remove(),this.makeOptionAvailable(c,b),this.showSelectedOptions(b),this.turbo.isEmpty(this.selects[b].selectedOption)){var d=this.selects[b].wrapper,e=this.generateLabel(this.selects[b].label,this.isSearchable(b));d.querySelector(".label").remove(),this.turbo.showElement(e,d.querySelector(".options-wrapper"),"prepend","block",{})}this.deleteAllSelectedOption(b)}},{key:"deleteAllSelectedOption",value:function deleteAllSelectedOption(a){for(var b,c=this.selects[a].options,d=!1,e=0;e<c.length;e++)b=c[e],b.value===this.selects[a].settings.allOptionsSelectedOptionValue&&(d=e);!1!==d&&this.selects[a].options.splice(d,1),this.deleteAllSelectedOptionElement(a)}},{key:"deleteAllSelectedOptionElement",value:function deleteAllSelectedOptionElement(a){var b,c=_createForOfIteratorHelper(this.selects[a].wrapper.querySelectorAll(".options div"));try{for(c.s();!(b=c.n()).done;){var d=b.value;this.turbo.getData(d,"value")===this.selects[a].settings.allOptionsSelectedOptionValue&&d.remove()}}catch(a){c.e(a)}finally{c.f()}}},{key:"makeOptionAvailable",value:function makeOptionAvailable(a,b){for(var c,d=this.getOptionInfoByValue(b,a),e=0;e<this.selects[b].selectedOption.length;e++)c=this.selects[b].selectedOption[e],c.value===a&&(this.selects[b].settings.multiselect.hideSelected?(this.selects[b].options.push(d),this.sortOptionsByDefault(b)):this.cancelDisability(b,a),this.selects[b].selectedOption.splice(e,1));this.selects[b].settings.multiselect.hideSelected||(this.selects[b].options=_toConsumableArray(this.activateSelectedOptions(b,this.selects[b].defaultOptions))),this.resetOptions(b,this.selects[b].options)}},{key:"sortOptionsByDefault",value:function sortOptionsByDefault(a){for(var b=_toConsumableArray(this.selects[a].defaultOptions),c={},d=[],e=0;e<b.length;e++)c[b[e].value]=e;var f,g=_createForOfIteratorHelper(this.selects[a].options);try{for(g.s();!(f=g.n()).done;){var h=f.value;d[c[h.value]]=h}}catch(a){g.e(a)}finally{g.f()}this.selects[a].options=d.filter(function(a){return a})}},{key:"cancelDisability",value:function cancelDisability(a,b){var c,d=_createForOfIteratorHelper(this.selects[a].options);try{for(d.s();!(c=d.n()).done;){var e=c.value;if(e.value===b){var f=e.attributes["class"].indexOf("disabled");e.disabled=!1,-1<f&&e.attributes["class"].splice(f,1)}}}catch(a){d.e(a)}finally{d.f()}}},{key:"getDefaultOptionIndex",value:function getDefaultOptionIndex(a,b){for(var c=0;c<this.selects[b].defaultOptions.length;c++)if(a===this.selects[b].defaultOptions[c].value)return c;return 0}},{key:"resetAvailableOptions",value:function resetAvailableOptions(a){var b,c=this.selects[a].wrapper,d=c.querySelector(".options"),e=_createForOfIteratorHelper(d.querySelectorAll("div"));try{for(e.s();!(b=e.n()).done;){var g=b.value;g.remove()}}catch(a){e.e(a)}finally{e.f()}var f=this.generateOptions(this.selects[a].options);this.showOptionsInWrapper(d,f),this.bindSelection(d.querySelectorAll("div"),a)}},{key:"showSelectedOptions",value:function showSelectedOptions(a){var b=this.selects[a].wrapper,c=this.selects[a].selectedOption,d=b.querySelector(".label"),e=b.querySelector(".options-wrapper"),f=this.getUsableOptionWrapperWidth(e),g=0;d.textContent="";var h,i=_createForOfIteratorHelper(c);try{for(i.s();!(h=i.n()).done;){var j=h.value,k=this.generateSelectedOption(j.text,j.value);this.turbo.showElement(k,d,"append","inline-flex",{}),g+=this.getElementUsedWidth(k),this.mustBePlacedBelowFirstRow(f,g)&&k.classList.add("next-row"),this.bindOptionDelete(k,a)}}catch(a){i.e(a)}finally{i.f()}if(this.isSearchable(a)){var l=this.generateLabel(null,!0,!0);this.turbo.showElement(l,d,"append","inline-flex",{}),this.bindFiltering(l,a),l.focus()}this.setOptionWrapperPosition(a)}},{key:"getUsableOptionWrapperWidth",value:function getUsableOptionWrapperWidth(a){var b=parseFloat(this.turbo.getCss(a,"width")),c=parseFloat(this.turbo.getCss(a,"padding-right"))+parseFloat(this.turbo.getCss(a,"padding-left"));return b-(c-this.beautySpace)}},{key:"getElementUsedWidth",value:function getElementUsedWidth(a){var b=parseFloat(this.turbo.getCss(a,"width")),c=parseFloat(this.turbo.getCss(a,"margin-right"))+parseFloat(this.turbo.getCss(a,"margin-left"));return b+c}},{key:"mustBePlacedBelowFirstRow",value:function mustBePlacedBelowFirstRow(a,b){return a<b}},{key:"hideSelectedOption",value:function hideSelectedOption(a,b){var c=this.turbo.getData(b,"value");if(this.selects[a].settings.multiselect.hideSelected){b.remove();var d,e=_createForOfIteratorHelper(this.selects[a].selectedOption);try{for(e.s();!(d=e.n()).done;){var j=d.value;if(j.value===c){j.element=null;break}}}catch(a){e.e(a)}finally{e.f()}for(var f,g=null,h=0;h<this.selects[a].options.length;h++)f=this.selects[a].options[h],f.value===c&&(g=h);null!==g&&(this.selects[a].options=_toConsumableArray(this.selects[a].options),this.selects[a].options.splice(g,1))}else this.makeOptionDisabled(a,b)}},{key:"makeOptionDisabled",value:function makeOptionDisabled(a,b){var c=this.turbo.getData(b,"value");b.classList.add("disabled");var d,e=_createForOfIteratorHelper(this.selects[a].options);try{for(e.s();!(d=e.n()).done;){var f=d.value;c===f.value&&(f.disabled=!0,f.attributes["class"].push("disabled"))}}catch(a){e.e(a)}finally{e.f()}}},{key:"addAllSelectedOption",value:function addAllSelectedOption(a){var b=this.generateAdditionalOption(a,"allSelected"),c=this.generateOptions([b]),d=this.selects[a].wrapper,e=d.querySelector(".options");this.showOptionsInWrapper(e,c),this.bindSelection(e.querySelectorAll("div"),a),this.selects[a].options.push(b)}},{key:"unsetSelected",value:function unsetSelected(a){var b=this.isMultiselect(a);b||(this.selects[a].selectedOption=null);var c,d=_createForOfIteratorHelper(this.selects[a].defaultOptions);try{for(d.s();!(c=d.n()).done;){var e=c.value,f=_toConsumableArray(e.attributes["class"]),g=f.indexOf("active");-1<g&&f.splice(g,1),e.attributes["class"]=f}}catch(a){d.e(a)}finally{d.f()}}},{key:"canSelectOption",value:function canSelectOption(a,b){var c=a;this.turbo.isNode(a)?(c=this.turbo.getData(a,"value"),!!!c&&(c=a.value)):this.turbo.isObject(a)&&a.value&&(c=a.value);var d=this.getOptionInfoByValue(b,c);if(!!(null!==d&&void 0!==d&&d.disabled))return!1;if(!!(null!==d&&void 0!==d&&d.notFoundOption))return!1;if(this.isMultiselect(b)){var e,f=this.selects[b].selectedOption,g=_createForOfIteratorHelper(f);try{for(g.s();!(e=g.n()).done;){var h=e.value;if(d.value===h.value)return!1}}catch(a){g.e(a)}finally{g.f()}}return!0}},{key:"getOptionInfoByValue",value:function getOptionInfoByValue(a,b){if(b===this.selects[a].settings.notFoundOptionValue)return{notFoundOption:!0};var c=this.selects[a].defaultOptions.filter(function(a){return a.value===b});if(c.length)return c[0]}},{key:"isSelected",value:function isSelected(a,b){var c;if(this.isMultiselect(a)){var d,e=_createForOfIteratorHelper(this.selects[a].selectedOption);try{for(e.s();!(d=e.n()).done;){var f=d.value;if(f.value===b)return!0}}catch(a){e.e(a)}finally{e.f()}}return(null===(c=this.selects[a].selectedOption)||void 0===c?void 0:c.value)===b}},{key:"resetSelect",value:function resetSelect(a,b,c){var d=a.querySelectorAll("div"),e=this.isSearchable(c),f=this.isMultiselect(c);f||(this.selects[c].selectedOption=null),b=this.generateLabel(this.selects[c].label,e);for(var g,h=0;h<d.length;h++)g=d[h],g.classList.contains("active")&&g.classList.remove("active");this.resetOptions(c)}},{key:"resetOptions",value:function resetOptions(a){var b,c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this.selects[a].wrapper,f=e.querySelector(".options"),g=f.querySelectorAll("div");if(this.turbo.isEmpty(d)){var j=this.selects[a].defaultOptions;c=_toConsumableArray(j),j=this.activateSelectedOptions(a,j),b=this.generateOptions(j)}else b=this.generateOptions(d),c=_toConsumableArray(d);var h,i=_createForOfIteratorHelper(g);try{for(i.s();!(h=i.n()).done;){var k=h.value;k.remove()}}catch(a){i.e(a)}finally{i.f()}this.showOptionsInWrapper(f,b),this.bindSelection(f.querySelectorAll("div"),a),this.selects[a].options=_toConsumableArray(c)}},{key:"triggerChangeEvent",value:function triggerChangeEvent(a){var b=new Event("change");a.dispatchEvent(b)}},{key:"bindFiltering",value:function bindFiltering(a,b){var c=this,d=a.closest(".options-wrapper").querySelector(".options");a.addEventListener("input",function(){var e=a.value.toLowerCase(),f=c.filterOptions(e,b);c.replaceOptions(d,f,b)})}},{key:"filterOptions",value:function filterOptions(a,b){var c=this.isMultiselect(b)?this.selectableOptions(b):this.selects[b].defaultOptions,d=[],e=[];if(""===a)return c;var f,g=_createForOfIteratorHelper(c);try{for(g.s();!(f=g.n()).done;){var h=f.value,i=h.value,j=h.text,k=i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),l=j.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");-1<l.indexOf(a)&&(d.push(h),e.push(i)),this.selects[b].settings.searchAlsoValue&&!e.includes(i)&&-1<k.indexOf(a)&&d.push(h)}}catch(a){g.e(a)}finally{g.f()}return d}},{key:"selectableOptions",value:function selectableOptions(a){var b,c=[],d=[],e=_createForOfIteratorHelper(this.selects[a].selectedOption);try{for(e.s();!(b=e.n()).done;){var i=b.value;c.push(i.value)}}catch(a){e.e(a)}finally{e.f()}for(var f,g=0,h=_toConsumableArray(this.selects[a].defaultOptions);g<h.length;g++)f=h[g],c.includes(f.value)||d.push(f);return d}},{key:"replaceOptions",value:function replaceOptions(a,b,c){b=this.activateSelectedOptions(c,b);var d,e=this.generateOptions(b),f=this.selects[c].wrapper.querySelector(".options"),g=_createForOfIteratorHelper(a.querySelectorAll("div"));try{for(g.s();!(d=g.n()).done;){var i=d.value;i.remove()}}catch(a){g.e(a)}finally{g.f()}this.turbo.isEmpty(b)&&(b=[this.generateAdditionalOption(c)],e=this.generateOptions(b)),this.selects[c].options=b,this.showOptionsInWrapper(f,e);var h=this.selects[c].wrapper.querySelectorAll(".options div");this.bindSelection(h,c)}},{key:"activateSelectedOptions",value:function activateSelectedOptions(a,b){var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e=c.value,f=_toConsumableArray(e.attributes["class"]),g=f.indexOf("active");-1<g&&f.splice(g,1),this.isSelected(a,e.value)&&f.push("active"),e.attributes["class"]=f}}catch(a){d.e(a)}finally{d.f()}return b}}]),a}();module.exports=Select;